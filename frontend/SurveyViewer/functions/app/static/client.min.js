const ajax=(e={})=>{const{csrfToken:n,method:r="POST",url:l=""}=e;return new Promise((t,a)=>{const e=new XMLHttpRequest;e.onreadystatechange=e=>{4===e.target.readyState&&(200===e.target.status?e.target.responseText&&t(e.target.responseText):(console.log(e),a(new Error(`no data: url: ${e.target.responseURL}, status: `+e.target.status))))},e.open(r,l,!0),e.withCredentials=!0,e.setRequestHeader("CSRF-Token",n),e.send()})},createElement=(e,t,a,n=[])=>{const r=document.createElement(e);return r.innerText=t,n.forEach(({name:e,value:t})=>{r.setAttribute(e,t)}),a.appendChild(r),r},showSurvey=async e=>{var t=document.querySelector("#survey");t&&(createElement("h1",`Hej ${e.participantName}!`,t),createElement("h2",`Willkommen zur Umfrage ${e.surveyName}!`,t))},showClosedSurvey=async e=>{showSurvey(e);var t=document.querySelector("#survey");if(t){createElement("h3","Die Umfrage ist bereits geschlossen!",t);const a=createElement("div",null,t);e.questions.forEach(({text:e,choices:t})=>{createElement("div",e,a);e=t.find(e=>e.isSelected);createElement("div",e.text,a)})}},showOpenSurvey=async e=>{showSurvey(e);var t=document.querySelector("#survey");if(t){const n=createElement("form",null,t,[{name:"method",value:"POST"},{name:"action",value:"../submit"}]),a=document.querySelector("#csrf");n.appendChild(a.cloneNode(!0)),createElement("input",null,n,[{name:"type",value:"hidden"},{name:"value",value:e.participantId},{name:"id",value:"participantId"},{name:"name",value:"participantId"}]),e.questions.forEach(({id:e,text:t,choices:a})=>{createElement("label",t,n,[{name:"for",value:e}]);const r=createElement("select",null,n,[{name:"id",value:e},{name:"name",value:e},{name:"required",value:"required"}]);a.forEach(({isSelected:e,text:t,value:a})=>{const n=[];a&&n.push({name:"value",value:a}),e&&n.push({name:"selected",value:"selected"}),createElement("option",t,r,n)})}),createElement("input",null,n,[{name:"type",value:"submit"},{name:"value",value:"Abstimmen"}])}},csrfElement=document.getElementById("csrf");if(csrfElement){const K=csrfElement.getAttribute("value");ajax({csrfToken:K}).then(e=>{e=JSON.parse(e);e.isClosed?showClosedSurvey(e).catch(e=>console.log(e)):showOpenSurvey(e).catch(e=>console.log(e))}).catch(e=>{console.log("ERROR"),console.log(e)})}